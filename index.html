<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Futuristic CRUD App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #141e30, #243b55);
      color: #fff;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      color: #00c6ff;
      font-size: 1.8em;
      margin-bottom: 20px;
    }
    #config-section {
      margin-bottom: 20px;
      background: #243b55;
      padding: 15px;
      border-radius: 8px;
    }
    #config-section h2 {
      font-size: 1.2em;
      margin: 0 0 10px;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }
    input, button {
      padding: 12px;
      margin: 5px 0;
      border: none;
      border-radius: 5px;
      font-size: 1em;
    }
    input {
      background: #fff;
      color: #333;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      cursor: pointer;
      background: #00c6ff;
      color: #fff;
      transition: background 0.3s;
      padding: 12px;
    }
    button:hover {
      background: #0072ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #243b55;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #fff;
    }
    th {
      background: #1a2b44;
    }
    td button {
      margin-right: 5px;
      padding: 8px 12px;
      font-size: 0.9em;
    }
    .table-container {
      overflow-x: auto;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }
      #config-section h2 {
        font-size: 1em;
      }
      input, button {
        font-size: 0.9em;
        padding: 10px;
      }
      th, td {
        font-size: 0.85em;
        padding: 8px;
      }
      td button {
        padding: 6px 10px;
        font-size: 0.8em;
      }
      .input-group {
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <h1>Futuristic CRUD App - IP Registration</h1>
  <div id="config-section">
    <h2>Configure Telegram Bot</h2>
    <input type="text" id="telegram-token" placeholder="Enter Telegram Bot Token">
    <div>
      <button onclick="saveTelegramToken()">Save Token</button>
      <button onclick="setWebhook()">Set Webhook</button>
      <button onclick="syncData()">Sync with GitHub</button>
    </div>
  </div>
  <div class="input-group">
    <input type="text" id="name" placeholder="Name">
    <input type="date" id="expiration" placeholder="Expiration Date">
    <input type="text" id="ip" placeholder="IP Address">
    <button onclick="addEntry()">Add Entry</button>
  </div>
  <div class="table-container">
    <table id="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Expiration</th>
          <th>IP</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <script>
    const BASE_URL = 'https://your-vercel-app.vercel.app/api'; // Replace with your Vercel app URL

    async function saveTelegramToken() {
      const token = document.getElementById('telegram-token').value;
      if (!token) {
        alert('Please enter a Telegram bot token.');
        return;
      }
      const response = await fetch(`${BASE_URL}/save-telegram-token`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token })
      });
      const result = await response.json();
      alert(result.message);
    }

    async function setWebhook() {
      const response = await fetch(`${BASE_URL}/set-webhook`, { method: 'POST' });
      const result = await response.json();
      alert(result.message);
    }

    async function syncData() {
      const response = await fetch(`${BASE_URL}/sync-data`, { method: 'POST' });
      const result = await response.json();
      alert(result.message);
      if (result.success) readFile();
    }

    async function addEntry() {
      const name = document.getElementById('name').value;
      const expiration = document.getElementById('expiration').value;
      const ip = document.getElementById('ip').value;
      if (!name || !expiration || !ip) {
        alert('Please fill out all fields.');
        return;
      }
      const response = await fetch(`${BASE_URL}/add-entry`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, expiration, ip })
      });
      const result = await response.json();
      alert(result.message);
      if (result.success) readFile();
    }

    async function editEntry(index, name, expiration, ip) {
      const newName = prompt('Enter new name:', name);
      const newExpiration = prompt('Enter new expiration date (YYYY-MM-DD):', expiration);
      const newIp = prompt('Enter new IP address:', ip);
      if (newName && newExpiration && newIp) {
        const response = await fetch(`${BASE_URL}/edit-entry`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index, name: newName, expiration: newExpiration, ip: newIp })
        });
        const result = await response.json();
        alert(result.message);
        if (result.success) readFile();
      }
    }

    async function deleteEntry(index) {
      if (confirm('Are you sure you want to delete this entry?')) {
        const response = await fetch(`${BASE_URL}/delete-entry`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index })
        });
        const result = await response.json();
        alert(result.message);
        if (result.success) readFile();
      }
    }

    async function readFile() {
      const response = await fetch(`${BASE_URL}/read-file`);
      const data = await response.json();
      if (data.success) {
        renderTable(data.rows);
      } else {
        alert(`Failed to load data: ${data.message}`);
      }
    }

    function renderTable(rows) {
      const tableBody = document.querySelector('#table tbody');
      tableBody.innerHTML = '';
      rows.forEach((row, index) => {
        const [_, name, expiration, ip] = row.split(' ');
        const tableRow = `
          <tr>
            <td>${name}</td>
            <td>${expiration}</td>
            <td>${ip}</td>
            <td>
              <button onclick="editEntry(${index}, '${name}', '${expiration}', '${ip}')">Edit</button>
              <button onclick="deleteEntry(${index})">Delete</button>
            </td>
          </tr>
        `;
        tableBody.innerHTML += tableRow;
      });
    }

    readFile();
  </script>
</body>
</html>
